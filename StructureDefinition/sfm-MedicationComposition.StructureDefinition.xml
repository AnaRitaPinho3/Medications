<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <id value="sfm-MedicationComposition" />
  <url value="http://ehelse.no/fhir/StructureDefinition/sfm-MedicationComposition" />
  <version value="1.0" />
  <name value="SfmMedicationComposition" />
  <title value="sfm-MedicationComposition" />
  <status value="draft" />
  <date value="2019-09-24" />
  <description value="Bundle for use in SFM API for aggregated medication and prescription info" />
  <purpose value="The purpose of this profile is to define the structure of the SfmMedicationBundle." />
  <fhirVersion value="4.0.0" />
  <kind value="resource" />
  <abstract value="false" />
  <type value="Composition" />
  <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Composition" />
  <derivation value="constraint" />
  <differential>
    <element id="Composition">
      <path value="Composition" />
      <short value="Norwegian Composition for PLL and Prescriptions" />
      <definition value="Norwegian Composition for PLL and Prescriptions. A composition for aggregated information provided by SFM to systems consuming the API Basis. The Composition is a result of lookup to national systems for prescription (Reseptformidleren) and medication history from Kjernejounal. The composition is also used for submitting updates to the nationals systems. The PLL (short for Pasientens LegemiddelListe : Patient medication list) is supported by separate identifier in sfmMedicationStatement." />
      <comment value="The Composition refers to some sfm specific profiles, and other norwegian basis profiles (no-basis). This may change over time untill final specification is published in advance of initial production release of SFM API Basis " />
    </element>
    <element id="Composition.subject">
      <path value="Composition.subject" />
      <short value="Identification of the patient" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://hl7.no/fhir/StructureDefinition/no-basis-Patient" />
        <aggregation value="bundled" />
      </type>
    </element>
    <element id="Composition.attester">
      <path value="Composition.attester" />
      <slicing>
        <discriminator>
          <type value="profile" />
          <path value="party.reference" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <definition value="When submitting this composition to SFM: One for the Practitioner and one for the organisation" />
      <max value="2" />
    </element>
    <element id="Composition.attester:sliceAttesterPractitioner">
      <path value="Composition.attester" />
      <sliceName value="sliceAttesterPractitioner" />
      <max value="2" />
    </element>
    <element id="Composition.attester:sliceAttesterPractitioner.party">
      <path value="Composition.attester.party" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://hl7.no/fhir/StructureDefinition/no-basis-Practitioner" />
      </type>
    </element>
    <element id="Composition.attester:sliceAttesterOrganisation">
      <path value="Composition.attester" />
      <sliceName value="sliceAttesterOrganisation" />
      <max value="2" />
    </element>
    <element id="Composition.attester:sliceAttesterOrganisation.party">
      <path value="Composition.attester.party" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://hl7.no/fhir/StructureDefinition/no-basis-Organization" />
      </type>
    </element>
    <element id="Composition.section">
      <path value="Composition.section" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="code.coding.code" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <short value="Medication list" />
      <definition value="This defined sections of this Composition are defined as slices" />
      <min value="1" />
    </element>
    <element id="Composition.section:sectionPLLinfo">
      <path value="Composition.section" />
      <sliceName value="sectionPLLinfo" />
      <code>
        <system value="http://ehelse.no/fhir/CodeSystem/sfm-section-types" />
        <code value="sectionPLL" />
      </code>
      <short value="toplevel info from PLL" />
      <definition value="Contains information on special practitioner roles and delivery information for multidose patients" />
      <min value="1" />
      <max value="1" />
      <mustSupport value="true" />
    </element>
    <element id="Composition.section:sectionPLLinfo.entry">
      <path value="Composition.section.entry" />
      <max value="1" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehelse.no/fhir/StructureDefinition/sfm-PLL-info" />
        <aggregation value="referenced" />
        <aggregation value="bundled" />
      </type>
    </element>
    <element id="Composition.section:sectionMedication">
      <path value="Composition.section" />
      <sliceName value="sectionMedication" />
      <code>
        <system value="http://ehelse.no/fhir/CodeSystem/sfm-section-types" />
        <code value="sectionMedication" />
      </code>
      <short value="Medication section" />
      <definition value="This section contains the medication info representation in national systems" />
      <min value="1" />
      <max value="1" />
      <mustSupport value="true" />
    </element>
    <element id="Composition.section:sectionMedication.entry">
      <path value="Composition.section.entry" />
      <short value="A reference to sfm-MedicationStatemen" />
      <definition value="Medication entries in the MedicationComposition" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehelse.no/fhir/StructureDefinition/sfm-MedicationStatement" />
        <aggregation value="referenced" />
        <aggregation value="bundled" />
      </type>
    </element>
    <element id="Composition.section:sectionOtherPrescriptions">
      <path value="Composition.section" />
      <sliceName value="sectionOtherPrescriptions" />
      <code>
        <system value="http://ehelse.no/fhir/CodeSystem/sfm-section-types" />
        <code value="sectionOtherPrescriptions" />
      </code>
      <definition value="This section contains the non-medicinal prescriptions for the patient" />
      <min value="1" />
      <max value="1" />
      <mustSupport value="true" />
    </element>
    <element id="Composition.section:sectionOtherPrescriptions.entry">
      <path value="Composition.section.entry" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehelse.no/fhir/StructureDefinition/sfm-BandaProduct" />
        <targetProfile value="http://ehelse.no/fhir/StructureDefinition/sfm-NutritionStatement" />
        <aggregation value="referenced" />
        <aggregation value="bundled" />
      </type>
    </element>
    <element id="Composition.section:sectionAllergies">
      <path value="Composition.section" />
      <sliceName value="sectionAllergies" />
      <code>
        <system value="http://ehelse.no/fhir/CodeSystem/sfm-section-types" />
        <code value="sectionAllergies" />
      </code>
      <definition value="A list of known allergies for the particular patient. " />
      <min value="1" />
      <max value="1" />
      <mustSupport value="true" />
    </element>
    <element id="Composition.section:sectionAllergies.entry">
      <path value="Composition.section.entry" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://hl7.no/fhir/StructureDefinition/no-basis-AllergyIntolerance" />
      </type>
    </element>
    <element id="Composition.section:sectionDispense">
      <path value="Composition.section" />
      <sliceName value="sectionDispense" />
      <code>
        <system value="http://ehelse.no/fhir/CodeSystem/sfm-section-types" />
        <code value="sectionDispense" />
      </code>
      <short value="Dispense information from Pharamcy and Bandasjist" />
      <definition value="Dispense information for the patient. Only present when reading the resouce from SFM." />
      <max value="1" />
      <mustSupport value="true" />
    </element>
    <element id="Composition.section:sectionDispense.entry">
      <path value="Composition.section.entry" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehelse.no/fhir/StructureDefinition/sfm-MedicationDispense" />
        <targetProfile value="http://ehelse.no/fhir/StructureDefinition/sfm-GeneralDispense" />
      </type>
    </element>
    <element id="Composition.section:sliceResponse">
      <path value="Composition.section" />
      <sliceName value="sliceResponse" />
      <code>
        <system value=" http://ehelse.no/fhir/CodeSystem/sfm-section-types" />
        <code value="sectionResponse" />
      </code>
      <short value="Section for respons to applications" />
      <definition value="This section holds the responses to SLV applications." />
      <max value="1" />
    </element>
    <element id="Composition.section:sliceResponse.entry">
      <path value="Composition.section.entry" />
      <short value="Application responses" />
      <definition value="Entry will refere a sfm-SlvResponse" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://ehelse.no/fhir/StructureDefinition/sfm-SlvResponse" />
      </type>
    </element>
  </differential>
</StructureDefinition>